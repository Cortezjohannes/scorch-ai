========================================================
JSON PARSING FIX FOR AZURE GPT ‚úÖ
========================================================

ISSUE:
‚ùå "Expected property name or '}' in JSON at position 1"
‚ùå Azure GPT responses wrapped in markdown code blocks
‚ùå JSON extraction failing because response format different from Gemini

ROOT CAUSE:
üêõ Azure GPT often returns JSON wrapped in ```json ... ``` blocks
üêõ Old regex pattern didn't handle markdown formatting
üêõ Position 1 error suggests response starts with newline or markdown

FIXES APPLIED:
‚úÖ Strip markdown code blocks (```json and ```)
‚úÖ Better JSON extraction using first { and last }
‚úÖ Improved error logging with response previews
‚úÖ Two-level error recovery with better diagnostics

HOW IT WORKS NOW:

1. CLEAN RESPONSE:
   - Trim whitespace
   - Remove ```json or ``` markdown blocks
   - Handle both opening and closing code fences

2. EXTRACT JSON:
   - Find first { character
   - Find last } character
   - Extract substring between them
   - More reliable than regex matching

3. PARSE WITH RECOVERY:
   - First attempt: Direct parse
   - If fails: Log error with context
   - Second attempt: Remove control characters
   - If still fails: Return minimal structure

4. BETTER LOGGING:
   - Shows response preview on error
   - Shows JSON preview on parse error
   - Shows error position context
   - Helps debug what Azure GPT actually returned

CHANGES IN ALL 3 FUNCTIONS:
‚úÖ generateCoreMaterials() - Fixed JSON extraction
‚úÖ generateRelationshipMaterials() - Fixed JSON extraction
‚úÖ generatePracticeMaterials() - Fixed JSON extraction

FILES MODIFIED:
‚úÖ /src/services/ai-generators/actor-materials-generator.ts

RESULT:
‚ú® Handles Azure GPT's markdown-wrapped JSON responses
‚ú® More robust JSON extraction
‚ú® Better error messages for debugging
‚ú® Graceful fallback if parsing fails

The JSON parsing should now work correctly with Azure GPT! üé≠
